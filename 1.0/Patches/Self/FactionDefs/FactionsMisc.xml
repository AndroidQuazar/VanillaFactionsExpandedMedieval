<?xml version="1.0" encoding="utf-8"?>
<Patch>

    <!-- Add Ranged PawnKinds to faction group makers depending on whether or not VanillaWeaponsExpanded is loaded -->
    <Operation Class="PatchOperationFindMod">
        <mods>
            <li>Vanilla Weapons Expanded</li>
        </mods>

        <!-- With Vanilla Weapons Expanded -->
        <match Class="PatchOperationSequence">
            <success>Always</success>
            <operations>

                <!-- Combat (1) -->
                <li Class="PatchOperationAdd">
                    <xpath>/Defs/FactionDef[@Name="MedievalFactionBase"]/pawnGroupMakers/li[1]/options</xpath>
                    <value>
                        <Medieval_Crossbowman>10</Medieval_Crossbowman>
                        <Medieval_Longbowman>10</Medieval_Longbowman>
                    </value>
                </li>

                <!-- Combat (2) -->
                <li Class="PatchOperationAdd">
                    <xpath>/Defs/FactionDef[@Name="MedievalFactionBase"]/pawnGroupMakers/li[2]/options</xpath>
                    <value>
                        <Medieval_Crossbowman>10</Medieval_Crossbowman>
                        <Medieval_Longbowman>10</Medieval_Longbowman>
                    </value>
                </li>

                <!-- Peaceful -->
                <li Class="PatchOperationAdd">
                    <xpath>/Defs/FactionDef[@Name="MedievalFactionBase"]/pawnGroupMakers/li[4]/options</xpath>
                    <value>
                        <Medieval_Crossbowman>10</Medieval_Crossbowman>
                        <Medieval_Longbowman>10</Medieval_Longbowman>
                    </value>
                </li>

                <!-- Trader -->
                <li Class="PatchOperationAdd">
                    <xpath>/Defs/FactionDef[@Name="MedievalFactionBase"]/pawnGroupMakers/li[5]/guards</xpath>
                    <value>
                        <Medieval_Crossbowman>10</Medieval_Crossbowman>
                        <Medieval_Longbowman>10</Medieval_Longbowman>
                    </value>
                </li>

                <!-- Settlement -->
                <li Class="PatchOperationAdd">
                    <xpath>/Defs/FactionDef[@Name="MedievalFactionBase"]/pawnGroupMakers/li[6]/options</xpath>
                    <value>
                        <Medieval_Crossbowman>10</Medieval_Crossbowman>
                        <Medieval_Longbowman>10</Medieval_Longbowman>
                    </value>
                </li>

            </operations>
        </match>

        <!-- Vanilla fallback -->
        <nomatch Class="PatchOperationSequence">
            <success>Always</success>
            <operations>

                <!-- Combat (1) -->
                <li Class="PatchOperationAdd">
                    <xpath>/Defs/FactionDef[@Name="MedievalFactionBase"]/pawnGroupMakers/li[1]/options</xpath>
                    <value>
                        <Medieval_Archer>20</Medieval_Archer>
                    </value>
                </li>

                <!-- Combat (2) -->
                <li Class="PatchOperationAdd">
                    <xpath>/Defs/FactionDef[@Name="MedievalFactionBase"]/pawnGroupMakers/li[2]/options</xpath>
                    <value>
                        <Medieval_Archer>20</Medieval_Archer>
                    </value>
                </li>

                <!-- Peaceful -->
                <li Class="PatchOperationAdd">
                    <xpath>/Defs/FactionDef[@Name="MedievalFactionBase"]/pawnGroupMakers/li[4]/options</xpath>
                    <value>
                        <Medieval_Archer>20</Medieval_Archer>
                    </value>
                </li>

                <!-- Trader -->
                <li Class="PatchOperationAdd">
                    <xpath>/Defs/FactionDef[@Name="MedievalFactionBase"]/pawnGroupMakers/li[5]/guards</xpath>
                    <value>
                        <Medieval_Archer>20</Medieval_Archer>
                    </value>
                </li>

                <!-- Settlement -->
                <li Class="PatchOperationAdd">
                    <xpath>/Defs/FactionDef[@Name="MedievalFactionBase"]/pawnGroupMakers/li[6]/options</xpath>
                    <value>
                        <Medieval_Archer>20</Medieval_Archer>
                    </value>
                </li>

            </operations>
        </nomatch>
    </Operation>

</Patch>
<?xml version="1.0" encoding="utf-8"?>
<Patch>

    <!-- Add Ranged PawnKinds depending on whether or not VanillaWeaponsExpanded is loaded -->
    <Operation Class="PatchOperationFindMod">
        <mods>
            <li>Vanilla Weapons Expanded</li>
        </mods>

        <!-- Crossbowman and Longbowman if loaded -->
        <match Class="PatchOperationAdd">
            <xpath>/Defs</xpath>
            <value>
                <PawnKindDef ParentName="MedievalRangedBase">
                    <defName>Medieval_Crossbowman</defName>
                    <label>crossbowman</label>
                    <weaponTags>
                        <li>MedievalRangedCrossbow</li>
                    </weaponTags>
                </PawnKindDef>

                <PawnKindDef ParentName="MedievalRangedBase">
                    <defName>Medieval_Longbowman</defName>
                    <label>longbowman</label>
                    <weaponTags>
                        <li>MedievalRangedLongbow</li>
                    </weaponTags>
                </PawnKindDef>
            </value>
        </match>

        <!-- Otherwise Greatbows as a fallback, adding a unique tag to the Greatbow so that it's definitely the only weapon used -->
        <nomatch Class="PatchOperationSequence">
            <success>Always</success>
            <operations>

                <li Class="PatchOperationAdd">
                    <xpath>/Defs</xpath>
                    <value>
                        <PawnKindDef ParentName="MedievalRangedBase">
                            <defName>Medieval_Archer</defName>
                            <label>archer</label>
                            <weaponTags>
                                <li>VFEM_Archer</li>
                            </weaponTags>
                        </PawnKindDef>
                    </value>
                </li>

                <li Class="PatchOperationAdd">
                    <xpath>/Defs/ThingDef[defName="Bow_Great"]/weaponTags</xpath>
                    <value>
                        <li>VFEM_Archer</li>
                    </value>
                </li>

            </operations>
        </nomatch>
    </Operation>

</Patch>
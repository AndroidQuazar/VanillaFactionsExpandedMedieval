<?xml version="1.0" encoding="utf-8"?>
<Patch>

    <!-- Integration with Editable Backstories -->
    <Operation Class="PatchOperationFindMod">
        <mods>
            <li>[RF] Editable Backstories and Names [1.0]</li>
        </mods>
        <match Class="PatchOperationReplace">
            <xpath>/Defs/PawnKindDef[@Name="VFEM_MedievalPawnKindBase"]/backstoryCategories/li[text()="Tribal"]</xpath>
            <value>
                <li>Medieval</li>
            </value>
        </match>
    </Operation>

    <!-- Integration with Vanilla Weapons Expanded -->
    <Operation Class="PatchOperationFindMod">
        <mods>
            <li>Vanilla Weapons Expanded</li>
        </mods>
        <match Class="PatchOperationSequence">
            <success>Always</success>
            <operations>
            
                <!-- Peasants will be able to throw rocks -->
                <li Class="PatchOperationAdd">
                    <xpath>/Defs/PawnKindDef[defName="VFEM_Medieval_Peasant"]/weaponTags</xpath>
                    <value>
                        <li>MedievalRangedPeasant</li>
                    </value>
                </li>

            </operations>
        </match>
    </Operation>

    <!-- Integration with Vanilla Armour Expanded -->
    <Operation Class="PatchOperationFindMod">
        <mods>
            <li>Vanilla Armour Expanded</li>
        </mods>
        <match Class="PatchOperationSequence">
            <success>Always</success>
            <operations>

                <!-- Modify footman's armour -->
                <li Class="PatchOperationReplace">
                    <xpath>/Defs/PawnKindDef[defName="VFEM_Medieval_Footsoldier"]/apparelTags/li[text()="MedievalMilitary"]</xpath>
                    <value>
                        <li>MedievalArmorDecent</li>
                    </value>
                </li>

                <!-- Improve bowman's armour -->
                <li Class="PatchOperationSequence">
                    <success>Always</success>
                    <operations>
                        <li Class="PatchOperationTest">
                            <xpath>/Defs/PawnKindDef[defName="VFEM_Medieval_Bowman"]/apparelTags</xpath>
                            <success>Invert</success>
                        </li>
                        <li Class="PatchOperationAdd">
                            <xpath>/Defs/PawnKindDef[defName="VFEM_Medieval_Bowman"]</xpath>
                            <value>
                                <apparelTags/>
                            </value>
                        </li>
                    </operations>
                </li>
                <li Class="PatchOperationAdd">
                    <xpath>/Defs/PawnKindDef[defName="VFEM_Medieval_Bowman"]/apparelTags</xpath>
                    <value>
                        <li>MedievalArmorDecent</li>
                    </value>
                </li>

            </operations>
        </match>
    </Operation>

</Patch>